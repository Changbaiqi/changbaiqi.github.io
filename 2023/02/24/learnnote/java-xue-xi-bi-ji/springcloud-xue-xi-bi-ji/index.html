<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringCloud学习笔记 | 长白崎の个人博客</title><meta name="author" content="长白崎"><meta name="copyright" content="长白崎"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="SpringCloud学习笔记 1.Spring Cloud Eureka简介注册发现中心 Eureka来源于古希腊词汇，意为“发现了”。在软件领域，Eureka是Netflix在线影片公司开源的一个服务注册与发现的 组件，和其他Netflix公司的服务组件（例如负载均衡、熔断器、网关等）一起，被Spring Cloud社区整合为 Spring Cloud Netflix模块。 Eureka是Ne">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud学习笔记">
<meta property="og:url" content="http://blogs.changbaiqi.top/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/index.html">
<meta property="og:site_name" content="长白崎の个人博客">
<meta property="og:description" content="SpringCloud学习笔记 1.Spring Cloud Eureka简介注册发现中心 Eureka来源于古希腊词汇，意为“发现了”。在软件领域，Eureka是Netflix在线影片公司开源的一个服务注册与发现的 组件，和其他Netflix公司的服务组件（例如负载均衡、熔断器、网关等）一起，被Spring Cloud社区整合为 Spring Cloud Netflix模块。 Eureka是Ne">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blogs.changbaiqi.top/img/tyujhezcbn.webp">
<meta property="article:published_time" content="2023-02-24T09:46:09.000Z">
<meta property="article:modified_time" content="2025-04-23T17:49:42.076Z">
<meta property="article:author" content="长白崎">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="SpringCloud">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blogs.changbaiqi.top/img/tyujhezcbn.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SpringCloud学习笔记",
  "url": "http://blogs.changbaiqi.top/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/",
  "image": "http://blogs.changbaiqi.top/img/tyujhezcbn.webp",
  "datePublished": "2023-02-24T09:46:09.000Z",
  "dateModified": "2025-04-23T17:49:42.076Z",
  "author": [
    {
      "@type": "Person",
      "name": "长白崎",
      "url": "http://blogs.changbaiqi.top/"
    }
  ]
}</script><link rel="shortcut icon" href="https://q.qlogo.cn/headimg_dl?dst_uin=2084069833&spec=640&img_type=jpg"><link rel="canonical" href="http://blogs.changbaiqi.top/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.5"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=[object Object]"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', '[object Object]')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', '[object Object]', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringCloud学习笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/rightMenu.css"><link rel="stylesheet" href="/css/showAppreciation.css"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (true) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://q.qlogo.cn/headimg_dl?dst_uin=2084069833&amp;spec=640&amp;img_type=jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">145</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">125</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">59</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fa-fw fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/tyujhezcbn.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">长白崎の个人博客</span></a><a class="nav-page-title" href="/"><span class="site-name">SpringCloud学习笔记</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fa-fw fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SpringCloud学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-24T09:46:09.000Z" title="发表于 2023-02-24 09:46:09">2023-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-23T17:49:42.076Z" title="更新于 2025-04-23 17:49:42">2025-04-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring/">Spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">9.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>34分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/#post-comment"><span class="waline-comment-count" data-path="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="SpringCloud学习笔记"><a href="#SpringCloud学习笔记" class="headerlink" title="SpringCloud学习笔记"></a>SpringCloud学习笔记</h1><hr>
<h2 id="1-Spring-Cloud-Eureka简介"><a href="#1-Spring-Cloud-Eureka简介" class="headerlink" title="1.Spring Cloud Eureka简介"></a>1.Spring Cloud Eureka简介</h2><p>注册发现中心</p>
<p>Eureka来源于古希腊词汇，意为“发现了”。在软件领域，Eureka是Netflix在线影片公司开源的一个服务注册与发现的 组件，和其他Netflix公司的服务组件（例如负载均衡、熔断器、网关等）一起，被Spring Cloud社区整合为 Spring Cloud Netflix模块。</p>
<p>Eureka是Netflix贡献给Spring Cloud的一个框架！Netflix给Spring Cloud贡献了很多框架，后面我们会学习到！</p>
<h2 id="2-Spring-Cloud-Eureka和Zookeeper的区别"><a href="#2-Spring-Cloud-Eureka和Zookeeper的区别" class="headerlink" title="2.Spring Cloud Eureka和Zookeeper的区别"></a>2.Spring Cloud Eureka和Zookeeper的区别</h2><h3 id="2-1什么是CAP原则（面试）"><a href="#2-1什么是CAP原则（面试）" class="headerlink" title="2.1什么是CAP原则（面试）"></a>2.1什么是CAP原则（面试）</h3><blockquote>
<p>在分布式 微服务里面CAP定理</p>
<p>问：为什么zookeeper不适合做注册中心？</p>
<p>CAP原则又称CAP定理，指的是在一个分布式系统中，</p>
<p>一致性（Consistency）：三个机器中数据中一致的</p>
<p>可用性（Availability）：当有一个节点挂掉了整个集群可以继续对外提供服务</p>
<p>分区容错性（Partition tolerance） （这个特性是不可避免的）：由于机房或者分区等原因会导致各个机器中的数据短暂不一致</p>
<p>CAP原则指的是，这三个要素最多只能同时实现两点，不可能三者兼顾。</p>
<p>CP、AP</p>
<p>zk遵循CP原则</p>
<p>eureka注重AP高可用</p>
<p>eureka默认端口号为8761</p>
</blockquote>
<p>@EnableEurekaServer注解：开启eureka的注册中心的功能（在SpringBoot启动函数上面添加）</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Eureka%E7%95%8C%E9%9D%A2.png" alt="Eureka界面"></p>
<p>DS replicas：集群相关信息</p>
<p>Indtances currently registered with Eureka：当前在eureka里面注册哪些实例 真实的例子 具体的东西 class new Object</p>
<p>Status：实例 的状态和ID</p>
<h2 id="SpringCloud中的常用配置"><a href="#SpringCloud中的常用配置" class="headerlink" title="SpringCloud中的常用配置"></a>SpringCloud中的常用配置</h2><blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/SpringCloud%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE.png"></p>
</blockquote>
<h2 id="集群的深入理解"><a href="#集群的深入理解" class="headerlink" title="集群的深入理解"></a>集群的深入理解</h2><blockquote>
<p>如果是主从模式 主机该怎么选择？</p>
<p>如果是主从模式 数据是怎么同步的？  </p>
</blockquote>
<p>分布式数据一致性协议： Paxos raft</p>
<h2 id="Eureka概念的理解"><a href="#Eureka概念的理解" class="headerlink" title="Eureka概念的理解"></a>Eureka概念的理解</h2><hr>
<h3 id="服务的注册"><a href="#服务的注册" class="headerlink" title="服务的注册"></a>服务的注册</h3><blockquote>
<p>当项目启动时（eureka的客户端——，就会向eureka-server发送自己的元数据（原始数据）（运行的ip，端口port，健康的状态监控等，因为使用的是http/Restful请求风格），eureka-server会在自己内部保留这些元数据（内存中）。（有一个服务列表）（restful风格，以http动词的请求方式，完成对url资源的操作）</p>
</blockquote>
<h3 id="服务的续约"><a href="#服务的续约" class="headerlink" title="服务的续约"></a>服务的续约</h3><blockquote>
<p>项目启动成功了，除了向eureka-server注册自己成功，还会定时的向eureka-server汇报自己，心跳，表示自己还活着。（修改一个时间）</p>
</blockquote>
<h3 id="服务的下线（主动下线）"><a href="#服务的下线（主动下线）" class="headerlink" title="服务的下线（主动下线）"></a>服务的下线（主动下线）</h3><blockquote>
<p>当项目关闭时，会给eureka-server报告，说明自己要下机了。</p>
</blockquote>
<p>服务的剔除（被动下线，主动剔除）</p>
<blockquote>
<p>当项目超过了指定时间没有向eureka-server汇报自己，那么eureka0server就会认为此节点死掉了，会把它剔除掉，也不会放流量和请求到此节点 了。</p>
</blockquote>
<h2 id="Eureka运作原理的特点"><a href="#Eureka运作原理的特点" class="headerlink" title="Eureka运作原理的特点"></a>Eureka运作原理的特点</h2><blockquote>
<p>Eureka-server对外提供的是restful风格的服务</p>
<p>以http动词的形式对url资源进行操作 get、post、put、delete</p>
<p>http服务+特定的请求方式url地址</p>
<p>只要利用这些restful我们就能对项目实现注册和发现</p>
<p>只不过，eureka已经帮我们使用java语言写了client，让我们的项目只要依赖client就能实现注册和发现！</p>
<p>只要你会发起Http请求，那你就有可能自己实现服务的注册和发现。不管你是什么语言！</p>
</blockquote>
<h2 id="Eureka的yml配置文件："><a href="#Eureka的yml配置文件：" class="headerlink" title="Eureka的yml配置文件："></a>Eureka的yml配置文件：</h2><hr>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">8761</span>  <span class="comment">#eureka的默认端口8761</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">application:</span></span><br><span class="line">		<span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment">#应用名称 不要使用特殊字符（必须要写应用名称）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span> <span class="comment">#eureka的配置分为三类 sever client 实例的 eureka-server既是服务端有事客户端</span></span><br><span class="line">	<span class="attr">server:</span></span><br><span class="line">		<span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">10000</span> <span class="comment">#服务端间隔多少毫秒做定期删除的操作</span></span><br><span class="line">		<span class="attr">renewal-percent-threshold:</span> <span class="number">0.85</span>  <span class="comment">#续约百分比 超过85%的应用没有和你续约 那么eureka会保护服务 不会剔除</span></span><br><span class="line">	<span class="attr">instance:</span> <span class="comment">#实例的配置</span></span><br><span class="line">		<span class="attr">instance-id:</span> <span class="string">${eureka.instance.hostname}:${spring.application.name}:${server.port}</span> </span><br><span class="line">		<span class="attr">hostname:</span> <span class="string">locahost</span> <span class="comment">#主机名称或者服务的ip</span></span><br><span class="line">		<span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 以ip的形式显示具体的服务信息</span></span><br><span class="line">		<span class="attr">lease-renerwal-interval-in-seconds:</span> <span class="number">5</span> <span class="comment">#服务实例的续约的时间间隔</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">		<span class="attr">service-url:</span></span><br><span class="line">			<span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka,...(可以注册多个，用“,”隔开)</span></span><br><span class="line">		<span class="attr">register-with-eureka:</span> <span class="literal">false</span>  <span class="comment">#先将server自己注册自己的开关（目前为关掉，默认为true  ）</span></span><br><span class="line">		<span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment">#要不要去注册中心里获取其他服务地址</span></span><br><span class="line">		</span><br></pre></td></tr></tbody></table></figure>

<h3 id="yml使用技巧："><a href="#yml使用技巧：" class="headerlink" title="yml使用技巧："></a>yml使用技巧：</h3><blockquote>
<p> 比如defaulZone里面</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果EUREKA_SERVER_URL能获取到值就采用这个，否则就使用“:”后面的默认设定</span></span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">${EUREKA_SERVER_URL:http://localhost:8761}</span></span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<h2 id="Spring-Cloud-Ribbon"><a href="#Spring-Cloud-Ribbon" class="headerlink" title="Spring Cloud Ribbon"></a>Spring Cloud Ribbon</h2><h3 id="Ribbon概述"><a href="#Ribbon概述" class="headerlink" title="Ribbon概述"></a>Ribbon概述</h3><blockquote>
<p>Spring Cloud Ribbon 是一个基于HTTP和TCP的客户端负载均衡工具，它基于Netflix Ribbon实现。通过Spring Cloud的封装，可以让我们轻松地将面向服务的REST模板请求自动转换成客户端负载均衡的服务调用。轮询hash权重…</p>
<p>简单的说Ribbon就是netfix公司的一个开源项目，主要功能是提供客户端负载均衡算法和服务 调用。Ribbon客户端组件提供了一套完善的配置项，比如连接超时，重试等。</p>
<p>在Spring Cloud构建的微服务系统中，Ribbon作为服务 消费者的 负载均衡器，有两种使用方式，一种是和RestTemplate相结合，另一种是和OpenFeign相结合。OpenFeign已经默认集成了Ribbon，关于OpenFeign的内容将会在下一章进行详细讲解。Ribbon有很多子模块，但很多模块没有用于生产环境！</p>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">	<span class="attr">eager-load:</span></span><br><span class="line">		<span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#ribbon 借助eureka拉取服务列表</span></span><br><span class="line">	<span class="attr">eureka:</span></span><br><span class="line">		<span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">	<span class="attr">http:</span>  <span class="comment">#  我们使用ribbon 用的restTemplate发请求 java.net.HttpUrlConnection 发的请求  很方便  但是它不支持连接池</span></span><br><span class="line">		<span class="attr">client:</span> <span class="literal">false</span>  <span class="comment">#发请求的工具很多 httpClient 它支持连接池 效率好 如果你想改请求的工具 记得加上这个依赖即可</span></span><br><span class="line">	<span class="attr">okhttp:</span> <span class="comment"># 这个也是请求工具 移动端用的比较多 轻量 的请求</span></span><br><span class="line">		<span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure>







<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><blockquote>
<p>负载均衡，英文名称为Load Balance（LB）http://  lb://（负载均衡协议），其含义就是指将负载（工作任务）进行平衡、分摊到多个操作单元上进行运行，例如Web服务器、企业核心应用服务器和 其它主要任务服务器等，从而协同完成工作任务。</p>
<p>负载均衡构建在原有网络结构之上，它提供了一种透明且廉价有效的方法扩展服务器和网络设备的带宽、加强网络数据处理能力、增加吞吐量、提高网络的可用性和灵活性。</p>
</blockquote>
<h3 id="LoadBalanced注解-如果加了Eureka组件就户需要单独导入Ribbon了，Eureka自带"><a href="#LoadBalanced注解-如果加了Eureka组件就户需要单独导入Ribbon了，Eureka自带" class="headerlink" title="@LoadBalanced注解(如果加了Eureka组件就户需要单独导入Ribbon了，Eureka自带)"></a>@LoadBalanced注解(如果加了Eureka组件就户需要单独导入Ribbon了，Eureka自带)</h3><blockquote>
<p>使用这个注解加在RestTemplate();那么RestTemplate的 操作都会由ribbon来 操作</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"> <span class="meta">@LoadBalanced</span></span><br><span class="line"> <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>{</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">思考ribbon是这么将http://provider/hello 路径请求成功的</span><br><span class="line">http://127.0.0.1:8080/hello</span><br><span class="line">1.拦截这个请求</span><br><span class="line">2.截取主机名称</span><br><span class="line">3.借助eureka来做服务发现list&lt;&gt;</span><br><span class="line">4.通过负载均衡算法 拿到一个服务ip port</span><br><span class="line">5.reConstructURL</span><br><span class="line">6.发起请求</span><br></pre></td></tr></tbody></table></figure>
<p>只要你给restTemplate加了ribbon的注解 项目中这个对象发起的请求 都会走ribbon的代理</p>
<p>如果你想使用原生的restTemplate 就需要重新创建一个对象</p>
</blockquote>
<h3 id="按什么顺序启动服务好"><a href="#按什么顺序启动服务好" class="headerlink" title="按什么顺序启动服务好"></a>按什么顺序启动服务好</h3><blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/SpringCloud%E4%B8%ADRibbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.png"></p>
<p>最好先启动服务，再启动注册中心，然后再启动客户端（consumer）</p>
<p>因为consumer会每隔一段时间拉取注册中心的服务列表，而注册中心一下不会更列表，如果先启动consumer那么就会一开始拉取不到后面的服务（因为服务未开启注册中心的列表中没有任何服务）</p>
</blockquote>
<h2 id="Feign-里面默认自带了Ribbon！！！不用导"><a href="#Feign-里面默认自带了Ribbon！！！不用导" class="headerlink" title="Feign(里面默认自带了Ribbon！！！不用导)"></a>Feign(里面默认自带了Ribbon！！！不用导)</h2><p>Feign是申明性（注解）Web服务客户端。它使编写Web服务客户端更加容易。要使用Feign，请创建一个接口并对其进行注解。它具有可插入注解支持，包括Feign注解和JAX-RS注解。Feign还致辞可插拔编码器和解码器。Spring Cloud添加了对SpringMVC注解的支持，并支持使用HttpMessageConverters，SpringWeb中默认使用的注解。SpringCloud集成了Ribbon和Eureka以及SpringCloud LoadBalancer，以在使用Feign时提供负载平衡的http客户端。</p>
<p>Feign是一个<em>远程</em>调用的组件（接口，注解）http调用的</p>
<p>Feign集成了Ribbon Ribbon里面集成了eureka</p>
<h4 id="Feign中yml配置"><a href="#Feign中yml配置" class="headerlink" title="Feign中yml配置"></a>Feign中yml配置</h4><blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># feign只是帮你封装了远程调用的功能  底层还是ribbon  所以我们需要去修改ribbon的时间</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">3000</span> <span class="comment"># 给3s超时时间</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">3000</span> <span class="comment"># 链接服务的超时时间</span></span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<h3 id="Feign调用参数处理（开发重点）"><a href="#Feign调用参数处理（开发重点）" class="headerlink" title="Feign调用参数处理（开发重点）"></a>Feign调用参数处理（开发重点）</h3><h4 id="说在前面"><a href="#说在前面" class="headerlink" title="说在前面"></a>说在前面</h4><blockquote>
<p>Feign传参确保消费者和提供者的参数列表一致 包括返回值 方法签名要一致</p>
<p>1.通过URL传参数，GET请求，参数列表使用@PathVariable(“”)</p>
<p>2.如果GET请求 ，每个继承参数必须加@RequestParam(“”)</p>
<p>3.如果是POST请求，而且是对象集合等参数，必须加@RequestBody或者@RequestParam</p>
</blockquote>
<h2 id="Feign日志打印"><a href="#Feign日志打印" class="headerlink" title="Feign日志打印"></a>Feign日志打印</h2><blockquote>
<p>在SpringBoot启动中添加打印日志输出Bean</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>  <span class="comment">//开启feign的客户端功能 才可以帮助我们发起调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Study41Application</span> {</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">     SpringApplication.run(Study41Application.class, args);</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印feign日志信息 级别</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">level</span><span class="params">()</span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在yaml文件中配置：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.study4_1.study4_1.feign.UserOrderFeign:</span> <span class="string">debug</span>  <span class="comment">#我需要打印这个接口下面的日志</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure></blockquote>
<h2 id="Spring-Cloud-Hystrix"><a href="#Spring-Cloud-Hystrix" class="headerlink" title="Spring Cloud Hystrix"></a>Spring Cloud Hystrix</h2><p>什么叫服务雪崩：</p>
<blockquote>
<p>在一个分布式的系统中如果A服务请求B服务B可能要调用C服务，这个过程叫做链式调用</p>
<p>ABC是三个不同的Tomcat。</p>
<p>1.用户去请求A服务，A的tomcat会分配一个线程支持用户的访问</p>
<p>A发现需要完成用户的操作，需要去调用B</p>
<p>2.A去请求B，B的tomcat也会分配一个线程支持A的访问。B发现需要完成A的操作需要调用C。</p>
<p>3.B去调用C，但是C宕机了，B并不知道还是一如既往的去访问C。导致A和B的线程都没有回收，此时有大量请求进入A服务或者B服务。AB会报错503 Service Unavailable。</p>
<p>在分布式的链路中只要有一个服务宕机那么就可能导致一整个服务链瘫痪</p>
<p>服务雪崩的核心本质是什么？</p>
<p>线程没有及时回收</p>
<p>熔断，熔断！</p>
<p>直接return，业务是不能完成。但是可以缓解服务器压力</p>
<p>1.调整等待时间这样可以缓解压力，但是很有局限性不灵活，有的服务可能需要多的时间去执行</p>
<p>2.在上游服务中直到下一个服务的状态如果是ok的 就正常访问，如果是宕机了，那么就return。这样就可以缓解服务雪崩。</p>
<p>我们可以容忍服务挂掉，我们需要做对应的调整，我们可以设置一个被选方案（备胎）</p>
</blockquote>
<p>熔断器，也叫断路器！（正常情况下 断路器是关的 只有出了问题才打开）用来保护微服务不雪崩的方法。思想和我们上面画的拦截器一样。</p>
<p>Hystrix是Netfix公司开源的一个项目，它提供了熔断器功能，能够阻止分布式系统中出现联动故障。Hystrix是通过隔离服务的访问点阻止联动故障的，并提供了故障的解决方案，从而提高了整个分布式系统的弹性。微博 弹性云扩容 Docker K8s</p>
<h2 id="Hystrix快速入门"><a href="#Hystrix快速入门" class="headerlink" title="Hystrix快速入门"></a>Hystrix快速入门</h2><p>设置拦截器：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E8%AE%BE%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8.png"></p>
<h3 id="如何开启Hystrix："><a href="#如何开启Hystrix：" class="headerlink" title="如何开启Hystrix："></a>如何开启Hystrix：</h3><blockquote>
<p>2.0版本前只要导入Hystrix然后在yml用如下配置就行</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>但是超过2.0后此yaml配置改为了：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>然后注意在SpringBoot启动类中加入：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableHystrix</span>启动注解</span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<h2 id="Hystrix常用yaml配置："><a href="#Hystrix常用yaml配置：" class="headerlink" title="Hystrix常用yaml配置："></a>Hystrix常用yaml配置：</h2><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">	<span class="attr">command:</span>  <span class="comment">#default是全局控制，也可以换成单个方法控制，把default换成方法名即可</span></span><br><span class="line">		<span class="attr">circuitBreaker:</span></span><br><span class="line">			<span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment">#开启断路器</span></span><br><span class="line">			<span class="attr">requestVolumeThreshold:</span> <span class="number">3</span> <span class="comment">#失败次数(阈值) 10次</span></span><br><span class="line">			<span class="attr">sleepWindowInMilliseconds:</span> <span class="number">20000</span> <span class="comment">#窗口时间</span></span><br><span class="line">			<span class="attr">errorThesholdPerventage:</span> <span class="number">60</span> <span class="comment">#失败率</span></span><br><span class="line">		<span class="attr">execution:</span></span><br><span class="line">			<span class="attr">isolation:</span></span><br><span class="line">				<span class="attr">Strategy:</span> <span class="string">thread</span> <span class="comment">#隔离方式thread线程隔离集合 和SEMAPHORE信号量隔离级别</span></span><br><span class="line">				<span class="attr">thread:</span></span><br><span class="line">					<span class="attr">timeoutInMilliseconds:</span> <span class="number">3000</span> <span class="comment">#调用超时时长</span></span><br><span class="line">		<span class="attr">fallback:</span></span><br><span class="line">			<span class="attr">isolation:</span></span><br><span class="line">				<span class="attr">semaphore:</span></span><br><span class="line">					<span class="attr">maxConcurrentRequests:</span> <span class="number">1000</span> <span class="comment">#信号量隔离级别最大并发数</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">	<span class="attr">ReadTiemout:</span> <span class="number">5000</span> <span class="comment">#要结合feign的底层ribbon调用的时长</span></span><br><span class="line">	<span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">#隔离方法 两种隔离方式 thread线程池 按照group(10个线程)划分服务提供者，用户请求的线程和做远程的线程不一样</span></span><br><span class="line"><span class="comment">#好处 当B服务调用失败了 或者请求B服务的量太大了 不会对C服务造成影响 用户访问比较大的情况下使用比较好 异步的方式</span></span><br><span class="line"><span class="comment"># 缺点 线程间开销大，对机器性能影响</span></span><br><span class="line"><span class="comment"># 应用场景 调用第三方服务 并发量大的情况下</span></span><br><span class="line"><span class="comment"># SEMAPHORE 信号量隔离 每次请求进来 有一个原子计数器 做请求次数的++ 当请求完成以后 --</span></span><br></pre></td></tr></tbody></table></figure>

<p>hystrix本质是代理的feign的请求才能完成熔断的效果</p>
<h2 id="链路追踪的由来"><a href="#链路追踪的由来" class="headerlink" title="链路追踪的由来"></a>链路追踪的由来</h2><blockquote>
<p>在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的服务节点调用来协同生产最后的请求结果，每一个请求都会开成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引导起整个请求最后的失败。（不建议微服务中链路调用超过3次）</p>
</blockquote>
<h2 id="分布式链路调用的监控"><a href="#分布式链路调用的监控" class="headerlink" title="分布式链路调用的监控"></a>分布式链路调用的监控</h2><blockquote>
<p>sleuth+zipkin(zipkin就是一个可视化的监控控制台)</p>
<p>Zipkin是Twitter的一个开源项目，允许开发者收集Twitter各个服务上的监控数据，并提供查询接口。</p>
<p>该系统让开发者可通过一个Web前端轻松的收集和分析数据，例如用户每次请求服务的处理时间等 可方便的监测系统中存在的瓶颈</p>
</blockquote>
<h2 id="Zipkin-可视化平台"><a href="#Zipkin-可视化平台" class="headerlink" title="Zipkin(可视化平台)"></a>Zipkin(可视化平台)</h2><blockquote>
<p>SpringCloud从F版以后已经不需要自己构建Zipkon server了，只需要调用jar包即可</p>
<p><a target="_blank" rel="noopener" href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkon-server/">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkon-server/</a></p>
<p><a target="_blank" rel="noopener" href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkon-server/2.12.9/">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkon-server/2.12.9/</a></p>
</blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA1.png"></p>
<h2 id="Sleuth快速入门"><a href="#Sleuth快速入门" class="headerlink" title="Sleuth快速入门"></a>Sleuth快速入门</h2><p>eureka-server</p>
<p>consumer-user-service</p>
<p>provider-order-service</p>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1.添加依赖"></a>1.添加依赖</h3><p>consumer-user-service和provider-order-service都要加</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2.修改配置文件"></a>2.修改配置文件</h3><p>consumer-user-service和provider-order-service都要该配置文件</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">zipkin:</span></span><br><span class="line">		<span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">	<span class="attr">sleuth:</span></span><br><span class="line">		<span class="attr">sampler:</span></span><br><span class="line">			<span class="attr">probability:</span> <span class="number">1</span>  <span class="comment">#配置采样率 默认的采样比例为：0.1 即10%，所设置的值介于0到1之间，1则表示全部采集</span></span><br><span class="line">			<span class="attr">rate:</span> <span class="number">10</span> <span class="comment">#为了使用速率限制采样器，选择每秒间隔接受的 trace量，最小数字为0，最大值为2,147,483,647（int）默认为10。</span></span><br></pre></td></tr></tbody></table></figure>





<h2 id="Admin监控"><a href="#Admin监控" class="headerlink" title="Admin监控"></a>Admin监控</h2><hr>
<p>导包之后记得在SpringBoot启动上面加上注解：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="comment">//要配合EnableEurekaClient使用，因为要EnableClient拉取EnableServer(注册端)的服务列表</span></span><br></pre></td></tr></tbody></table></figure>

<p>监控端需要加入的依赖：</p>
<blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></blockquote>
<p>监控端如果想监控自己实际详细内容yml配置</p>
<blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">'*'</span>   <span class="comment">#暴露所有的监控端点（就是暴露Admin的所有详细的内容），如果一个服务需要被将空 那么就要将自身的一些情况（一些信息接口）暴露出去</span></span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<p>被监控端需要加入actuator依赖（不加的监控端点显示离线监控，但是能知道端点存活）：</p>
<blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        暴露自身检查端点 endpoints--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></blockquote>
<p>想要被监控端展示实际详细内容yml配置：</p>
<blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">'*'</span>   <span class="comment">#暴露所有的监控端点（就是暴露Admin的所有详细的内容），如果一个服务需要被将空 那么就要将自身的一些情况（一些信息接口）暴露出去</span></span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<h2 id="Spring-Cloud-Gateway-网关"><a href="#Spring-Cloud-Gateway-网关" class="headerlink" title="Spring Cloud Gateway(网关)"></a>Spring Cloud Gateway(网关)</h2><hr>
<p>先说什么是海关？</p>
<p>你出国或者回国都得经过海关才能进出自己的国家否则不准，网关也是这个意思。</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3.png"></p>
<p>网关可以承担的作用： </p>
<p>1.路由转发</p>
<p>2.安全控制 保护每个服务 不需要将每个服务暴露出去</p>
<p>3.负载均衡</p>
<h3 id="什么是网关"><a href="#什么是网关" class="headerlink" title="什么是网关"></a>什么是网关</h3><p>网关是微服务最边缘的服务，直接暴露给用户，用来做用户和微服务的桥梁</p>
<p>1.没有网关：客户端直接访问我们的微服务，会需要在客户端配置很多的ip：port，如果user-servie并发比较大，则无法完成负载均衡</p>
<p>2.有网关：客户访问网关，网关来访问微服务，（网关可以和注册中心整合，通过服务名称找到目标的ip：port）这样只需要使用服务名称即可访问微服务，可以实现负载均衡 ，可以实现token拦截，权限验证，限流等操作</p>
<h3 id="你们项目里面-用的什么网关？-gateway-SpringCloud官方网关-zuul"><a href="#你们项目里面-用的什么网关？-gateway-SpringCloud官方网关-zuul" class="headerlink" title="你们项目里面 用的什么网关？ gateway(SpringCloud官方网关)  zuul"></a>你们项目里面 用的什么网关？ gateway(SpringCloud官方网关)  zuul</h3><p>他是Spring Cloud官方提供的用来取代zuul(netflix)的新一代网关组件</p>
<p>（zuul：1.0，,2.0，zuul的本质，一组过滤器，根据自定义的过滤器，根据自定义的过滤器顺序来执行，本质就是web组件 web三大组件（监听器 过滤器 servlet）  拦截 springmvc）</p>
<p>Zuul1.0  使用的是BIO（Blocking  IO） tomcat7.0以前都是BIO性能一般</p>
<p>Zuul12.0 性能好NIO</p>
<p>AIO  异步非阻塞io  a+nio = aio = async + no blocking  io</p>
<p>Gateway的核心是过滤器，按照先后执行顺序来执行过滤操作 order 0 1 2</p>
<h3 id="web三大组件"><a href="#web三大组件" class="headerlink" title="web三大组件"></a>web三大组件</h3><p>servlet</p>
<p>listener</p>
<p>filter过滤器（啥都拦截 ）</p>
<p>interceptor 拦截器 他是springmvc的，主要拦截进入controller的请求的</p>
<p>总结：Gateway的核心逻辑也就是  路由转发+执行过滤器链</p>
<h3 id="Spring-Cloud-Gateway三大核心概念"><a href="#Spring-Cloud-Gateway三大核心概念" class="headerlink" title="Spring Cloud Gateway三大核心概念"></a>Spring Cloud Gateway三大核心概念</h3><h4 id="Route（路由）（重点-和-eureka结合做动态路由）"><a href="#Route（路由）（重点-和-eureka结合做动态路由）" class="headerlink" title="Route（路由）（重点  和 eureka结合做动态路由）"></a>Route（路由）（重点  和 eureka结合做动态路由）</h4><p>路由信息的组成：</p>
<p>由一个ID、一个目的URL、一组断言工厂、一组Filter组成、</p>
<p>如果路由断言为真，说明请求URL和配置路由匹配。</p>
<h4 id="Predicate（断言）（就是一个返回bool的表达式）"><a href="#Predicate（断言）（就是一个返回bool的表达式）" class="headerlink" title="Predicate（断言）（就是一个返回bool的表达式）"></a>Predicate（断言）（就是一个返回bool的表达式）</h4><p>Java8中的断言函数。lambda四大接口 供给型，消费型，函数型，断言型</p>
<p>Spring Cloud Gateway 中的断言函数输入类型是Spring5.0框架中的SererWebExchange。Spring Cloud Gateway的断言函数允许开发者去定义匹配来自于Http Request中的任何信息比如请求头 和参数。</p>
<h4 id="Filter（过滤）（重点）"><a href="#Filter（过滤）（重点）" class="headerlink" title="Filter（过滤）（重点）"></a>Filter（过滤）（重点）</h4><p>一个标准的Spring WebFilter。 web三大组件（servler listener filter）mvc interceptor</p>
<p>Spring Cloud Gateway 中的Filter分为两种类型的Filter，分别是Gareway Filter和Global Filter。过滤器Filter将会对请求和相应进行修改处理。</p>
<p>一个是针对某一个路由的filter  对某一个接口做限流</p>
<p>一个是针对全局filter    token   ip黑名单</p>
<h2 id="Gateway快速入门"><a href="#Gateway快速入门" class="headerlink" title="Gateway快速入门"></a>Gateway快速入门</h2><p>1.不用选择SpringWeb，Gareway用的自带的Netty！！！！（只要加入gareway依赖就行，其他都不用加）！！！！！！</p>
<p>配置网关只要在application.yml或者properties里面设置就行</p>
<h3 id="Gateway网关yml配置文件方式配置路由"><a href="#Gateway网关yml配置文件方式配置路由" class="headerlink" title="Gateway网关yml配置文件方式配置路由"></a>Gateway网关yml配置文件方式配置路由</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># 只要加了依赖  默认开启</span></span><br><span class="line">    <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">login-service-route</span>  <span class="comment">#  这个是路由的id 保持唯一即可</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8081</span>  <span class="comment"># uri统一资源标识符  url统一资源定位符</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Path=/doLogin</span>  <span class="comment">#  匹配规则  只要你匹配上了/doLogin 就往uri转发 并且将路径带上		  #- Path=/doLogin/**  </span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Gateway网关代码方式配置路由"><a href="#Gateway网关代码方式配置路由" class="headerlink" title="Gateway网关代码方式配置路由"></a>Gateway网关代码方式配置路由</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouteConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span>{</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">                .route(<span class="string">"login_service"</span>,r-&gt; r.path(<span class="string">"/guochuang"</span>).uri(<span class="string">"http://www.bilibili.com/"</span>))</span><br><span class="line"></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>yml配置文件方式与java代码配置方式不冲突，两者可以一起用</p>
<p>如果你的uri后面给了一个访问地址  和匹配地址相同  那么就不会再拼接 </p>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><blockquote>
<p>动态路由需要结合注册发现中心（Eureka）</p>
</blockquote>
<p>动态路由先要在Gateway中使用EurekaClient拉取EurekaServer的服务注册表，然后以后访问就可以使用http://…/[服务名称]/url确切拼接路径名</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># 只要加了依赖  默认开启</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">locator:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment"># 开启动态路由 开启通用应用名称 找到服务的功能</span></span><br><span class="line">        <span class="attr">lower-case-service-id:</span> <span class="literal">true</span> <span class="comment">#开启服务名称小写</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="第二种动态路由写法方式（推荐这种，这种不需要在访问路径加服务名称就可以直接访问）"><a href="#第二种动态路由写法方式（推荐这种，这种不需要在访问路径加服务名称就可以直接访问）" class="headerlink" title="第二种动态路由写法方式（推荐这种，这种不需要在访问路径加服务名称就可以直接访问）"></a>第二种动态路由写法方式（推荐这种，这种不需要在访问路径加服务名称就可以直接访问）</h4><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># 只要加了依赖  默认开启</span></span><br><span class="line">    <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">login-service-route</span>  <span class="comment">#  这个是路由的id 保持唯一即可</span></span><br><span class="line">        <span class="comment">#uri: http://localhost:8081  # uri统一资源标识符  url统一资源定位符</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://login-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Path=/doLogin</span>  <span class="comment">#  匹配规则  只要你匹配上了/doLogin 就往uri转发 并且将路径带上		  #- Path=/doLogin/**  </span></span><br></pre></td></tr></tbody></table></figure>





<h2 id="Predicate-断言工厂的使用【了解】"><a href="#Predicate-断言工厂的使用【了解】" class="headerlink" title="Predicate 断言工厂的使用【了解】"></a>Predicate 断言工厂的使用【了解】</h2><p>在gateway启动时会去加载一些路由断言工厂（判断一句话是否正确 一个boolean表达式）</p>
<p>断言是给某一个路由来设定的，比如：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># 只要加了依赖  默认开启</span></span><br><span class="line">    <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">login-service-route</span>  <span class="comment">#  这个是路由的id 保持唯一即可</span></span><br><span class="line">        <span class="comment">#uri: http://localhost:8081  # uri统一资源标识符  url统一资源定位符</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://login-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Path=/doLogin</span>  <span class="comment">#  匹配规则  只要你匹配上了/doLogin 就往uri转发 并且将路径带上		  #- Path=/doLogin/**  </span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">After=2022-03-22T09:42:59.521+08:00[Asua/Shanghai]</span> <span class="comment">#设定这个条件，就是说这个时间之后才可以访问这个路由，这就是断言的一种体现</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="能够添加断言条件的有这些"><a href="#能够添加断言条件的有这些" class="headerlink" title="能够添加断言条件的有这些"></a>能够添加断言条件的有这些</h3><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E8%B7%AF%E7%94%B1%E6%96%AD%E8%A8%80%E7%9A%84%E6%9D%A1%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%9C%89%E5%93%AA%E4%BA%9B.png"></p>
<p>比如：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E6%96%AD%E8%A8%80%E7%A4%BA%E4%BE%8B.png"></p>
<p>默认不能作用在动态路由上</p>
<h2 id="Filter过滤器工厂（重点）"><a href="#Filter过滤器工厂（重点）" class="headerlink" title="Filter过滤器工厂（重点）"></a>Filter过滤器工厂（重点）</h2><hr>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>gateway里面的过滤器和Servlet里面的过滤器，功能差不多，路由过滤器可以用于修改进入Http请求的返回Http响应</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Filter%E8%BF%87%E6%BB%A4%E5%99%A8.png"></p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><h4 id="按生命周期分两种"><a href="#按生命周期分两种" class="headerlink" title="按生命周期分两种"></a>按生命周期分两种</h4><p>pre  在业务逻辑之前</p>
<p>post  在业务逻辑之后</p>
<h4 id="按种类分也是两种"><a href="#按种类分也是两种" class="headerlink" title="按种类分也是两种"></a>按种类分也是两种</h4><p>GatewayFilter  需要配置某个路由，才能过滤。如果需要使用全局路由，需要配置Default Filters。</p>
<p>可以记录接口的访问次数，限流操作</p>
<p>GlobalFilter  全局过滤器，不需要配置路由，系统初始化作用到所有路由上</p>
<p>全局过滤器  统计请求次数  限流  token的校验  ip黑名单拦截   跨域本质（filter）</p>
<p>144  开头的电话  限制一些ip的访问</p>
<h3 id="GlobalFilter过滤器使用："><a href="#GlobalFilter过滤器使用：" class="headerlink" title="GlobalFilter过滤器使用："></a>GlobalFilter过滤器使用：</h3><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/GlobalFilter%E4%BD%BF%E7%94%A8.png"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义了一个过滤器</span></span><br><span class="line"><span class="comment"> * 如果有多个过滤器那么我们还要定义顺序，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyGlobalFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个就是过滤的方法</span></span><br><span class="line"><span class="comment">     * 责任链模式</span></span><br><span class="line"><span class="comment">     * 网关里面有使用   mybatis的 二级缓存变种责任链模式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="comment">//针对 请求的过滤 拿到请求  header  url   参数   ......</span></span><br><span class="line">         <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// HttpServletRequest   这个是web里面的</span></span><br><span class="line">        <span class="comment">//ServerHttpRequest  webFlux里面 响应式里面的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getURI().getPath();</span><br><span class="line">        System.out.println(path);</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line">        System.out.println(headers);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> request.getMethod().name();</span><br><span class="line">        System.out.println(methodName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">hostName</span> <span class="operator">=</span> request.getRemoteAddress().getHostName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipv4</span> <span class="operator">=</span> request.getHeaders().getHost().getHostString();</span><br><span class="line">        System.out.println(hostName);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//响应相关的数据</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//用了微服务 肯定是前后端分离的  前后端分离  一般前后通过json</span></span><br><span class="line">        <span class="comment">//{"code":200,"msg":"ok"}</span></span><br><span class="line">        <span class="comment">// 设置编码  响应头里面置</span></span><br><span class="line">        response.getHeaders().set(<span class="string">"content-type"</span>,<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        <span class="comment">// 组装业务返回值</span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        map.put(<span class="string">"code"</span>, HttpStatus.UNAUTHORIZED.value());</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"你未授权"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="comment">//把一个map转成yige字节</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            bytes = objectMapper.writeValueAsBytes(map);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//通过buffer工厂将字节数组包装成一个数据包</span></span><br><span class="line">        <span class="type">DataBuffer</span> <span class="variable">wrap</span> <span class="operator">=</span> response.bufferFactory().wrap(bytes);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(wrap));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行  到下一个过滤器了</span></span><br><span class="line">        <span class="comment">//return chain.filter(exchange);</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定顺序 的方法</span></span><br><span class="line"><span class="comment">     * 越小越先执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="IP地址访问过滤器实例："><a href="#IP地址访问过滤器实例：" class="headerlink" title="IP地址访问过滤器实例："></a>IP地址访问过滤器实例：</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 网关里面 过滤器</span></span><br><span class="line"><span class="comment"> * ip拦截</span></span><br><span class="line"><span class="comment"> * 请求都有一个源头</span></span><br><span class="line"><span class="comment"> * 电话 144  027  010</span></span><br><span class="line"><span class="comment"> * 请求-------&gt;gateway------&gt;service</span></span><br><span class="line"><span class="comment"> * 黑名单 black_list</span></span><br><span class="line"><span class="comment"> * 白名单</span></span><br><span class="line"><span class="comment"> * 根据数量</span></span><br><span class="line"><span class="comment"> * 像业务的服务  一般黑名单</span></span><br><span class="line"><span class="comment"> * 一般像数据库 用白名单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IPCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 网关的并发比较高  不要在网关里面直接操作mysql</span></span><br><span class="line"><span class="comment">     * 后台系统可以查询数据库  用户量  并发量不大</span></span><br><span class="line"><span class="comment">     * 如果并发量大  可以查redis 或者  在内存中写好</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; BLACK_LIST = Arrays.asList(<span class="string">"127.0.0.1"</span>,<span class="string">"144.128.232.147"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拿到ip</span></span><br><span class="line"><span class="comment">     * 2.校验ip是否和服规范</span></span><br><span class="line"><span class="comment">     * 3.放行/拦截</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getHeaders().getHost().getHostString();</span><br><span class="line">        <span class="comment">//查询数据库   看这个ip是否存在黑名单里面   mysql等数据库的并发</span></span><br><span class="line">        <span class="comment">// 只要是能存储数据地方都叫数据库  redis   mysql</span></span><br><span class="line">        <span class="keyword">if</span>(!BLACK_LIST.contains(ip)){</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拦截</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.getHeaders().set(<span class="string">"content-type"</span>,<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        map.put(<span class="string">"code"</span>, <span class="number">438</span>);</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"你是黑名单"</span>);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            bytes = objectMapper.writeValueAsBytes(map);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="type">DataBuffer</span> <span class="variable">wrap</span> <span class="operator">=</span> response.bufferFactory().wrap(bytes);</span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(wrap));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">5</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>因为Http是无状态的，所以如果要分布式微服务则需要建立token。</p>
<p>用户登录token注册例子：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping("doLogin")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doLogin</span><span class="params">(String name, String pwd)</span>{</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(pwd);</span><br><span class="line">        <span class="comment">//这里假设去做了登录</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, name, pwd, <span class="number">18</span>);</span><br><span class="line">        <span class="comment">//token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">//存起来</span></span><br><span class="line">        redisTemplate.opsForValue().set(token,user.toString(),Duration.ofSeconds(<span class="number">7200</span>))</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>一般放在请求头里面  一般key  Authorization        value  bearer token</p>
<p>Token拦截（Token保存在Redis里面）：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定好放行的路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; ALLOW_URL = Arrays.asList(<span class="string">"/login-service/doLogin"</span>,<span class="string">"/myUrl"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前提是？ 和前端约定好  一般放在请求头里面  一般key   Authorization   value  beare token</span></span><br><span class="line"><span class="comment">     * 1.拿到请求url</span></span><br><span class="line"><span class="comment">     * 2.判断放行</span></span><br><span class="line"><span class="comment">     * 3.拿到请求头</span></span><br><span class="line"><span class="comment">     * 4.拿到token</span></span><br><span class="line"><span class="comment">     * 5.校验</span></span><br><span class="line"><span class="comment">     * 6.放行/拦截</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getURI().getPath();</span><br><span class="line">        <span class="keyword">if</span>(!ALLOW_URL.contains(path)){</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line">        List&lt;String&gt; authorization = headers.get(<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(authorization)){</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> authorization.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.hasText(token)){</span><br><span class="line">                <span class="comment">//  约定好的有前缀的  bearer token</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">realToken</span> <span class="operator">=</span> token.replaceFirst(<span class="string">"bearer"</span>, <span class="string">""</span>);</span><br><span class="line">                <span class="keyword">if</span>(StringUtils.hasText(realToken)&amp;&amp;redisTemplate.hasKey(token)){</span><br><span class="line">                    <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//拦截</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.getHeaders().set(<span class="string">"content-type"</span>,<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//返回401</span></span><br><span class="line">        map.put(<span class="string">"code"</span>, HttpStatus.UNAUTHORIZED.value());</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"未授权"</span>);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            bytes = objectMapper.writeValueAsBytes(map);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="type">DataBuffer</span> <span class="variable">wrap</span> <span class="operator">=</span> response.bufferFactory().wrap(bytes);</span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(wrap));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="关于限流，面试不会直接问，而是间接来问-问-不卖超"><a href="#关于限流，面试不会直接问，而是间接来问-问-不卖超" class="headerlink" title="关于限流，面试不会直接问，而是间接来问  问  不卖超"></a>关于限流，面试不会直接问，而是间接来问  问  不卖超</h3><p>比如：如果在抢购过程中，用户量请求非常大，怎么确保商品不会卖超</p>
<p>Redis单线程（IO为什么快，因为我们现在的处理器是多核心数的，redis底层使用的是IO的多路复用）</p>
<p>一般人只会在意商品卖超，而忘记了限流的重要性</p>
<p>Mq（限流，削峰，异步，解耦合）</p>
<p>Mq+Redis+分布式锁</p>
<h2 id="Spring-Cloud-Alibaba"><a href="#Spring-Cloud-Alibaba" class="headerlink" title="Spring Cloud Alibaba"></a>Spring Cloud Alibaba</h2><hr>
<h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必须组件，方便开发者通过Spring Cloud编程模型轻松使用这些组件来开发分布式应用服务。</p>
<p>依托Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将Spring Cloud应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/SpringCloud%E7%BB%84%E4%BB%B6.png"></p>
<h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><p>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p>
<p>Nacos致力于发现、配置和管理微服务。Nacos提供了一组简单易用的特征集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p>
<p>Nacos帮助您更敏捷和容易地构建、交付和管理微服务平台、Nacos是构建以“服务”为中心的现代应用架构（例如微服务范式、云原生 范式）的服务基础设施。</p>
<h3 id="Nacos的核心概念"><a href="#Nacos的核心概念" class="headerlink" title="Nacos的核心概念"></a>Nacos的核心概念</h3><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.png"></p>
<h3 id="服务（Service）"><a href="#服务（Service）" class="headerlink" title="服务（Service）"></a>服务（Service）</h3><p>服务是指一个或一组软件功能（例如特定信息的检索或一组操作的执行），其目的是不同的客户端可以为不同的目的重用（例如通过跨进程的网络调用）。Nacos支持主流的服务生态，如Kubernetes Service、gRPC|Dubbo RPC Service 或者 Spring Cloud  RESTful Service。</p>
<h3 id="服务注册中心（Service-Registry）"><a href="#服务注册中心（Service-Registry）" class="headerlink" title="服务注册中心（Service Registry）"></a>服务注册中心（Service Registry）</h3><p>服务注册中心，它是服务实例及元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。服务和路由器的客户端查询服务注册表以查找服务的可用实例。服务注册中心可能会调用服务实例的健康检查API来验证它是否能够处理请求。</p>
<h3 id="服务元数据（Service-Metadata）"><a href="#服务元数据（Service-Metadata）" class="headerlink" title="服务元数据（Service Metadata）"></a>服务元数据（Service Metadata）</h3><p>服务元数据是指包括服务端点（endpoints）、服务标签、服务版本号、服务实例权重、路由规则、安全策略等描述服务的数据</p>
<h3 id="服务提供方（Service-Provider）"><a href="#服务提供方（Service-Provider）" class="headerlink" title="服务提供方（Service Provider）"></a>服务提供方（Service Provider）</h3><p>是指提供可复用和可调用服务的应用方</p>
<h3 id="服务消费方（Service-Consumer）"><a href="#服务消费方（Service-Consumer）" class="headerlink" title="服务消费方（Service Consumer）"></a>服务消费方（Service Consumer）</h3><p>是指会发起对某个服务调用的应用方</p>
<h3 id="配置（Configuration）—配置文件中心"><a href="#配置（Configuration）—配置文件中心" class="headerlink" title="配置（Configuration）—配置文件中心"></a>配置（Configuration）—配置文件中心</h3><p>在系统开发过程中通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在、目的是让静态的系统工件或者交付物（如WAR，JAR包等）更好地和实际的物理运行环境进行适配、配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成这个步骤。配置变更是调整系统运行时的行为的有效手段之一。</p>
<h3 id="配置管理（Configuretion-Management）"><a href="#配置管理（Configuretion-Management）" class="headerlink" title="配置管理（Configuretion Management）"></a>配置管理（Configuretion Management）</h3><p>在数据中心中，系统中所有配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动统称为配置管理。</p>
<h3 id="名字服务（Naming-Service）"><a href="#名字服务（Naming-Service）" class="headerlink" title="名字服务（Naming Service）"></a>名字服务（Naming Service）</h3><p>提供分布式系统中所有对象（Object）、实体（Entity）的“名称”到关联的元数据之间的映射管理服务，例如ServiceName -&gt; Endpoints Info，Distributed Lock Name -&gt; Lock Owner/Status Info，DNS Domain Name -&gt; IP List服务发现和DNS就是名字服务的2大场景。</p>
<h3 id="配置服务（Configuration-Service）"><a href="#配置服务（Configuration-Service）" class="headerlink" title="配置服务（Configuration Service）"></a>配置服务（Configuration Service）</h3><p>在服务或者应用运行过程中，提供动态配置或者元数据以及配置管理的服务提供者。</p>
<h3 id="NacosServer的安装和启动"><a href="#NacosServer的安装和启动" class="headerlink" title="NacosServer的安装和启动"></a>NacosServer的安装和启动</h3><p>NacosServer相对于EurekaServer，只不过EurekaServer使我们自己搭建的一个项目，而NacosServer是别人已经提供好了。</p>
<h4 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h4><p>先在官网下载好Nacos，Nacos是一个jar包，直接启动即可。然后就是配置好里面的配置文件，现在conf文件里面修改properties内的数据库连接这些：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B61.png"></p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE.png" alt="Nacos数据库配置"></p>
<p>Nacos默认为集群配置，如果是想设置成单个若没有改启动模式为单个那么会报错，修改的地方直接在start文件里面改就行：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AE%BE%E5%AE%9A.png"></p>
<h4 id="Java编写配置："><a href="#Java编写配置：" class="headerlink" title="Java编写配置："></a>Java编写配置：</h4><p>首先要导入Nacos的依赖，Spring官方可能没有依赖的直接选择项，可以切换依赖来源网站为：<a target="_blank" rel="noopener" href="http://www.start.alibaba.com/">http://www.start.alibaba.com</a></p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4spring%E6%9D%A5%E6%BA%90%E9%85%8D%E7%BD%AE.png"></p>
<p>然后进行Nacos依赖选择：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacosjava%E4%BE%9D%E8%B5%96%E9%80%89%E6%8B%A9.png"></p>
<h4 id="Nacos的基本yml配置："><a href="#Nacos的基本yml配置：" class="headerlink" title="Nacos的基本yml配置："></a>Nacos的基本yml配置：</h4><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-client-b</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">discovery:</span>  <span class="comment"># 这里是和注册相关的配置</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">2666d147-6a14-403f-bc7e-1bf7faae7bff</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">A_GROUP</span>  <span class="comment"># 往哪个组里面注册</span></span><br><span class="line">        <span class="attr">service:</span> <span class="string">user-service</span>  <span class="comment"># 这个才是注册列表的名字 如果不写 默认是取${spring.application.name}</span></span><br></pre></td></tr></tbody></table></figure>

<p>namespace是最重要的，这个用来区分项目项，group可以详细对项目下进行分组</p>
<h4 id="Nacos整合Gateway网关"><a href="#Nacos整合Gateway网关" class="headerlink" title="Nacos整合Gateway网关"></a>Nacos整合Gateway网关</h4><p>Gateway要依赖SpringCloud，所以一定要确认SpringCloud和SpringBoot和SpringCloudAlibaba之间的版本关系！！！！！！</p>
<p>这里使用方法是差不多的，首先加上合适的依赖后：</p>
<p>yml相关的配置文件：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">2666d147-6a14-403f-bc7e-1bf7faae7bff</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">A_GROUP</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启动态路由</span></span><br><span class="line">          <span class="attr">lower-case-service-id:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>然后就是启动类加上网关开启的配置：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosGatewayApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(NacosGatewayApplication.class, args);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>完成~。</p>
<h3 id="常用Nacos中yaml文件配置代码："><a href="#常用Nacos中yaml文件配置代码：" class="headerlink" title="常用Nacos中yaml文件配置代码："></a>常用Nacos中yaml文件配置代码：</h3><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE1.png"></p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE2.png"></p>
<h3 id="Nacos配置文件中心"><a href="#Nacos配置文件中心" class="headerlink" title="Nacos配置文件中心"></a>Nacos配置文件中心</h3><p>配置文件中心作用 </p>
<p>如果生成环境修改了配置文件项目学需要下架重新打包，重新发布。</p>
<p>方便管理，以及配置文件中心修改后可以及时更新而且项目本源不用重启(类似于热部署更新)，爽！！！</p>
<p>只要配置文件修改了对应的服务就可以动态感知到不需要重启</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BF%83.png"></p>
<h3 id="配置文件中心配置方式"><a href="#配置文件中心配置方式" class="headerlink" title="配置文件中心配置方式"></a>配置文件中心配置方式</h3><h4 id="Nacos端"><a href="#Nacos端" class="headerlink" title="Nacos端"></a>Nacos端</h4><p>需要先在Nacos端创建好配置文件的组：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png"></p>
<p>Data id：对应的存储id</p>
<p>Group：对应的组别</p>
<h4 id="Java端："><a href="#Java端：" class="headerlink" title="Java端："></a>Java端：</h4><p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E7%9A%84java%E9%85%8D%E7%BD%AE1.png"></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-a</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">nacos-config-a</span>  <span class="comment"># 读哪个配置文件</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span>  <span class="comment">#  文件类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#      config:</span></span><br><span class="line"><span class="comment">#        namespace:</span></span><br><span class="line"><span class="comment">#        group:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目在启动的时候去哪里找它对应的配置文件呢？</span></span><br><span class="line"><span class="comment"># 新版本的的Cloud默认禁止bootstrap，需要在依赖中加入 spring-cloud-starter-bootstrap</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里如果bootstrap无效，可能是你SpringBoot与SpringBootCloud Alibaba的版本对应有问题。</p>
<p>SpringBoot的2.4版本后strap与原本的SpringBoot分离了，所以需要重新加入一个依赖</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>然后就是Java内容的引用：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E7%9A%84java%E9%85%8D%E7%BD%AE2.png"></p>
<p>@RefreshScope注解的作用是让这个类里面的所有Value注解都能随着配置文件中心的属性而变化。</p>
<h3 id="配置文件的读取方式（重点）"><a href="#配置文件的读取方式（重点）" class="headerlink" title="配置文件的读取方式（重点）"></a>配置文件的读取方式（重点）</h3><p>Nacos配置中心通过namespace、dataId和group来唯一确定一条配置。</p>
<ul>
<li><p>Namespace：即命名空间。默认的命名空间为public，我们可以在Nacos控制台中新建命名空间；</p>
</li>
<li><p>dataId：即配置文件名称</p>
</li>
<li><p>Group：即配置分组，默认为DEFAULT_GROUP，可以通过其中：dataId是最关键的配置字段：格式如下：</p>
<p>${prefix}           -    ${spring.profiles.active}</p>
<p>${file-extension}</p>
<p>说明：</p>
</li>
<li><p>prefix默认为spring.application.name的值，也可以通过配置项spring.cloud.nacos.config.prefix来配置；</p>
</li>
<li><p>spring.profiles.active即为当前环境对应的profile。注意，当spring.profiles.active为空时，对应的连接符-也将不存在，dataId的拼接格式变成${prefix}.${file-extension};</p>
</li>
<li><p>file-extension为配置内容的数据格式，可以通过配置项spring.cloud.nacos.config.file-extension来配置</p>
<p>这就是上面我们为什么能获得到配置的原因了。</p>
<p>注意：在写dataId的时候一定要添加文件类型后缀</p>
<p>Eg：nacos-config-dev.yml</p>
</li>
</ul>
<h3 id="多配置文件读取："><a href="#多配置文件读取：" class="headerlink" title="多配置文件读取："></a>多配置文件读取：</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">dcc36983-39b3-485a-b2f5-5f27bb6f1744</span>  <span class="comment"># 目前读取多配置文件的方式只支持在同一个命名空间下</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attr">extension-configs:</span> <span class="comment">#  可以读多个配置文件  需要在同一个命名空间下面  可以是不同的组</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">user-center-dev.yml</span></span><br><span class="line">            <span class="attr">group:</span> <span class="string">A_GROUP</span></span><br><span class="line">            <span class="attr">refresh:</span> <span class="literal">true</span>  <span class="comment">#是否支持刷新  这里支持动态刷新</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">member-center-dev.yml</span></span><br><span class="line">            <span class="attr">group:</span> <span class="string">B_GROUP</span></span><br><span class="line">            <span class="attr">regresh:</span> <span class="literal">false</span> <span class="comment"># 是否支持刷新  这里不去动态 刷新</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96.png"></p>
<h3 id="公共配置文件配置："><a href="#公共配置文件配置：" class="headerlink" title="公共配置文件配置："></a>公共配置文件配置：</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">dcc36983-39b3-485a-b2f5-5f27bb6f1744</span>  <span class="comment"># 目前读取多配置文件的方式只支持在同一个命名空间下</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">user-center</span></span><br><span class="line">        <span class="attr">shared-configs:</span>    <span class="comment">#  共享配置文件</span></span><br><span class="line">          <span class="comment">#- application-dev.yml   # 这里可以写共享的文件名称  只能在DEFAULT_GROUP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">application-dev.yml</span>  <span class="comment">#  这两种写法都可以</span></span><br><span class="line">            <span class="attr">grou:</span> <span class="string">C_GROUP</span></span><br><span class="line">            <span class="attr">refresh:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E5%85%AC%E5%85%B1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96.png"></p>
<p>Nacos常用配置：</p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE1.png"></p>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/Nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE2.png"></p>
<h3 id="两端的配置文件写什么内容"><a href="#两端的配置文件写什么内容" class="headerlink" title="两端的配置文件写什么内容"></a>两端的配置文件写什么内容</h3><p>本地的bootstrap.yml（应用名称，配置文件中心（注册中心地址），读取的配置文件名称信息）</p>
<p>远端的配置文件（端口，数据源，redis，mq，mybatis，Swagger…）</p>
<p>为了方便去动态刷新和修改</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><h3 id="单体结构："><a href="#单体结构：" class="headerlink" title="单体结构："></a>单体结构：</h3><blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E5%8D%95%E4%BD%93%E7%BB%93%E6%9E%84%E5%9B%BE.png"></p>
</blockquote>
<h3 id="分布式聚合项目："><a href="#分布式聚合项目：" class="headerlink" title="分布式聚合项目："></a>分布式聚合项目：</h3><blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E5%88%86%E5%B8%83%E5%BC%8F%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE.png"></p>
</blockquote>
<h3 id="分布式聚合项目优化方案1："><a href="#分布式聚合项目优化方案1：" class="headerlink" title="分布式聚合项目优化方案1："></a>分布式聚合项目优化方案1：</h3><blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/%E5%88%86%E5%B8%83%E5%BC%8F%E8%80%A6%E5%90%88%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%881.png"></p>
<p>其中将原本的mapper、service、web整合成了core或者enter。</p>
<p>模块清晰，轻耦合</p>
</blockquote>
<p>分布式聚合项目优化方案2：</p>
<blockquote>
<p><img src="/images/loading2.gif" data-original="/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/images/分布式聚合项目优化方案2.png"></p>
<p>之间的依赖关系明显比方案一少，清晰。</p>
</blockquote>
<h2 id="分布式微服务父项目配置案例"><a href="#分布式微服务父项目配置案例" class="headerlink" title="分布式微服务父项目配置案例"></a>分布式微服务父项目配置案例</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!--lookup parent from repository--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nnlg-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>2021.0.3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-cloud.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://blogs.changbaiqi.top">长白崎</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://blogs.changbaiqi.top/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/">http://blogs.changbaiqi.top/2023/02/24/learnnote/java-xue-xi-bi-ji/springcloud-xue-xi-bi-ji/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://blogs.changbaiqi.top" target="_blank">长白崎の个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud</a></div><div class="post-share"><div class="social-share" data-image="/img/tyujhezcbn.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/springboot-xue-xi-bi-ji/" title="SpringBoot"><img class="cover" src="/img/ae9a1729c7a2c9f12ccef9b25478c670.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">SpringBoot</div></div><div class="info-2"><div class="info-item-1">SpringBoot 第一章  为什么要使用SpringBoot 因为Spring，SpringMVC需要使用的大量的配置文件（xml文件） 还需要配置各种对象，把使用的对象放入到spring容器中才能使用对象 需要了解其他框架配置规则。  SpringBoot就相当于不需要配置文件的Spring+SpringMVC。常用的框架和第三方库都已经配置好了。 拿来就可以使用...</div></div></div></a><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/webrtc/" title="WebRTC进阶"><img class="cover" src="/img/ryujfn.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">WebRTC进阶</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/18/learnnote/java-xue-xi-bi-ji/activemq-xue-xi/" title="ActiveMQ学习"><img class="cover" src="/img/ae9a1729c7a2c9f12ccef9b25478c670.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-18</div><div class="info-item-2">ActiveMQ学习</div></div><div class="info-2"><div class="info-item-1">ActiveMQ学习 1.解压activemq压缩包，重命名文件夹 12tar -zxvf apache-activemq-5.11.1-bin.tar.gzmv apache-activemq-5.11.1 activemq  2.防火墙开启activemq端口8161（管理平台端口）和61616（通讯端口） 123vi /etc/sysconfig/iptables-A INPUT -m state --state NEW -m tcp -p tcp --dport 8161 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 61616 -j ACCEPT  3.启动、访问、查看状态和停止activemq服务 1234./activemq/bin/activemq startwget 192.168.2.137:8161./activemq/bin/activemq status./activemq/bin/activemq...</div></div></div></a><a class="pagination-related" href="/2023/11/27/learnnote/java-xue-xi-bi-ji/deeplearning4j-shen-du-xue-xi-kuang-jia-shi-yong/" title="Deeplearning4j深度学习框架使用"><img class="cover" src="/img/wallhaven-wqery6-dark.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-27</div><div class="info-item-2">Deeplearning4j深度学习框架使用</div></div><div class="info-2"><div class="info-item-1">Deeplearning4j深度学习框架使用 </div></div></div></a><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/jdbc-xue-xi-bi-ji/" title="JDBC学习笔记"><img class="cover" src="/img/tyujhezcbn.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-24</div><div class="info-item-2">JDBC学习笔记</div></div><div class="info-2"><div class="info-item-1">JDBC学习笔记 1.JDBC是什么？ Java DataBase Connectivity（Java语言连接数据库）   2.JDBC的本质是什么？ JDBC是SUN公司制定的一套接口（interface） java.sql.*;（这个软件包下有很多接口） 接口都有调用者和实现者。 面向接口调用、面向接口写实现类，这都属于面向接口编程。 为什么要面向接口编程？ 解耦合：降低程序的耦合度，提高程序的扩展能力。 多态机制就是非常典型的：面向抽象编程。(不要面向具体编程)  建议：12345678910Animal a = new Cat();Animal a = new Dog();//喂养的方法public void feed(Animal a){//面向父类幸型编程。        }//不建议：Dog d  = new Dog();Cat c = new Cat();  思考：为什么SUN制定一套JDBC接口呢？ 因为每一个数据库的底层实现原理都不一样。 Oracle数据库有自己的原理。 MySQL数据库也有自己的原理。 MS...</div></div></div></a><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/java-zhi-servlet-xue-xi-bi-ji/" title="Java之Servlet学习"><img class="cover" src="/img/ae9a1729c7a2c9f12ccef9b25478c670.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-24</div><div class="info-item-2">Java之Servlet学习</div></div><div class="info-2"><div class="info-item-1">Java之Servlet学习 流程图：  一、Servlet规范介绍：1.servlet规范来自于JAVAEE规范中的一种2.作用： 在servlet规范中，指定【动态资源文件】开发步骤  在servlet规范中，指定Http服务器调用动态资源文件规则  在servlet规范中，指定Http服务器管理动态资源文件实例对象规则   注：第一个是给人看的，后两个是给Http服务器看的  二、Servlet接口实现类：1.Servlet接口来自于Servlet规范下一个接口，这个接口存在Http服务器提供Jar包2.Tomcat服务器下lib文件夹中有一个servlet-api.jar存放Servlet接口（javax.servlet.Servlet)3.Servlet规范中任务，Http服务器能调用的【动态资源文件】必须是一个Servlet接口实现类 列子： 12345678class Student{    //不是动态资源文件，Tomcat无权调用}class Teacher implements Servlet{    //合法动态资源文件，Tomcat有权调用   ...</div></div></div></a><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/java-zhi-springmvc-xue-xi-bi-ji/" title="SpringMVC简介"><img class="cover" src="/img/yjsbsb.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-24</div><div class="info-item-2">SpringMVC简介</div></div><div class="info-2"><div class="info-item-1">SpringMVC简介1.SpringMVC概述 SpringMVC是一种基于Java的实现MVC设计模型的请求驱动类型的轻量级Web框架，属于SpringFrameWork的后续产品，已经融合在Spring Web...</div></div></div></a><a class="pagination-related" href="/2023/02/24/learnnote/java-xue-xi-bi-ji/java-zhi-spring-kuang-jia-xue-xi-bi-ji/" title="Java之Spring框架学习笔记"><img class="cover" src="/img/20200606114204_zqvry.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-24</div><div class="info-item-2">Java之Spring框架学习笔记</div></div><div class="info-2"><div class="info-item-1">Java之Spring框架学习笔记一、介绍：1.1.Spring是什么 Spring是分层的JavaSE/EE应用full-stack轻量级开源框架，以IOC（Inverse Of Control：反转控制）和AOP（Aspect Oriented...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://q.qlogo.cn/headimg_dl?dst_uin=2084069833&amp;spec=640&amp;img_type=jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">长白崎</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">145</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">125</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">59</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Changbaiqi"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Changbaiqi" target="_blank" title="Github"><i class="fab fa-github" style="color: #4a7dbe;"></i></a><a class="social-icon" href="mailto:changbaiqi@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/36987520" target="_blank" title="BiliBili"><i class="fab fa-bilibili" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Ciallo～(∠・ω< )⌒★</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringCloud%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">SpringCloud学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Spring-Cloud-Eureka%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.Spring Cloud Eureka简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Spring-Cloud-Eureka%E5%92%8CZookeeper%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.</span> <span class="toc-text">2.Spring Cloud Eureka和Zookeeper的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E4%BB%80%E4%B9%88%E6%98%AFCAP%E5%8E%9F%E5%88%99%EF%BC%88%E9%9D%A2%E8%AF%95%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1什么是CAP原则（面试）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">SpringCloud中的常用配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">集群的深入理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eureka%E6%A6%82%E5%BF%B5%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">Eureka概念的理解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C"><span class="toc-number">1.5.1.</span> <span class="toc-text">服务的注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%BB%AD%E7%BA%A6"><span class="toc-number">1.5.2.</span> <span class="toc-text">服务的续约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%8B%E7%BA%BF%EF%BC%88%E4%B8%BB%E5%8A%A8%E4%B8%8B%E7%BA%BF%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">服务的下线（主动下线）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eureka%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.6.</span> <span class="toc-text">Eureka运作原理的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eureka%E7%9A%84yml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.7.</span> <span class="toc-text">Eureka的yml配置文件：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#yml%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%9A"><span class="toc-number">1.7.1.</span> <span class="toc-text">yml使用技巧：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Ribbon"><span class="toc-number">1.8.</span> <span class="toc-text">Spring Cloud Ribbon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ribbon%E6%A6%82%E8%BF%B0"><span class="toc-number">1.8.1.</span> <span class="toc-text">Ribbon概述</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.9.</span> <span class="toc-text">负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LoadBalanced%E6%B3%A8%E8%A7%A3-%E5%A6%82%E6%9E%9C%E5%8A%A0%E4%BA%86Eureka%E7%BB%84%E4%BB%B6%E5%B0%B1%E6%88%B7%E9%9C%80%E8%A6%81%E5%8D%95%E7%8B%AC%E5%AF%BC%E5%85%A5Ribbon%E4%BA%86%EF%BC%8CEureka%E8%87%AA%E5%B8%A6"><span class="toc-number">1.9.1.</span> <span class="toc-text">@LoadBalanced注解(如果加了Eureka组件就户需要单独导入Ribbon了，Eureka自带)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%BB%80%E4%B9%88%E9%A1%BA%E5%BA%8F%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%A5%BD"><span class="toc-number">1.9.2.</span> <span class="toc-text">按什么顺序启动服务好</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Feign-%E9%87%8C%E9%9D%A2%E9%BB%98%E8%AE%A4%E8%87%AA%E5%B8%A6%E4%BA%86Ribbon%EF%BC%81%EF%BC%81%EF%BC%81%E4%B8%8D%E7%94%A8%E5%AF%BC"><span class="toc-number">1.10.</span> <span class="toc-text">Feign(里面默认自带了Ribbon！！！不用导)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Feign%E4%B8%ADyml%E9%85%8D%E7%BD%AE"><span class="toc-number">1.10.0.1.</span> <span class="toc-text">Feign中yml配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Feign%E8%B0%83%E7%94%A8%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%EF%BC%88%E5%BC%80%E5%8F%91%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">1.10.1.</span> <span class="toc-text">Feign调用参数处理（开发重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">说在前面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Feign%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0"><span class="toc-number">1.11.</span> <span class="toc-text">Feign日志打印</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Hystrix"><span class="toc-number">1.12.</span> <span class="toc-text">Spring Cloud Hystrix</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hystrix%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.13.</span> <span class="toc-text">Hystrix快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFHystrix%EF%BC%9A"><span class="toc-number">1.13.1.</span> <span class="toc-text">如何开启Hystrix：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hystrix%E5%B8%B8%E7%94%A8yaml%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.14.</span> <span class="toc-text">Hystrix常用yaml配置：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">1.15.</span> <span class="toc-text">链路追踪的由来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B0%83%E7%94%A8%E7%9A%84%E7%9B%91%E6%8E%A7"><span class="toc-number">1.16.</span> <span class="toc-text">分布式链路调用的监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zipkin-%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0"><span class="toc-number">1.17.</span> <span class="toc-text">Zipkin(可视化平台)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sleuth%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.18.</span> <span class="toc-text">Sleuth快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">1.18.1.</span> <span class="toc-text">1.添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.18.2.</span> <span class="toc-text">2.修改配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Admin%E7%9B%91%E6%8E%A7"><span class="toc-number">1.19.</span> <span class="toc-text">Admin监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Gateway-%E7%BD%91%E5%85%B3"><span class="toc-number">1.20.</span> <span class="toc-text">Spring Cloud Gateway(网关)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E5%85%B3"><span class="toc-number">1.20.1.</span> <span class="toc-text">什么是网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E4%BB%AC%E9%A1%B9%E7%9B%AE%E9%87%8C%E9%9D%A2-%E7%94%A8%E7%9A%84%E4%BB%80%E4%B9%88%E7%BD%91%E5%85%B3%EF%BC%9F-gateway-SpringCloud%E5%AE%98%E6%96%B9%E7%BD%91%E5%85%B3-zuul"><span class="toc-number">1.20.2.</span> <span class="toc-text">你们项目里面 用的什么网关？ gateway(SpringCloud官方网关)  zuul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">1.20.3.</span> <span class="toc-text">web三大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-Gateway%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.20.4.</span> <span class="toc-text">Spring Cloud Gateway三大核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Route%EF%BC%88%E8%B7%AF%E7%94%B1%EF%BC%89%EF%BC%88%E9%87%8D%E7%82%B9-%E5%92%8C-eureka%E7%BB%93%E5%90%88%E5%81%9A%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%EF%BC%89"><span class="toc-number">1.20.4.1.</span> <span class="toc-text">Route（路由）（重点  和 eureka结合做动态路由）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Predicate%EF%BC%88%E6%96%AD%E8%A8%80%EF%BC%89%EF%BC%88%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E8%BF%94%E5%9B%9Ebool%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%89"><span class="toc-number">1.20.4.2.</span> <span class="toc-text">Predicate（断言）（就是一个返回bool的表达式）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter%EF%BC%88%E8%BF%87%E6%BB%A4%EF%BC%89%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">1.20.4.3.</span> <span class="toc-text">Filter（过滤）（重点）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gateway%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.21.</span> <span class="toc-text">Gateway快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E7%BD%91%E5%85%B3yml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-number">1.21.1.</span> <span class="toc-text">Gateway网关yml配置文件方式配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E7%BD%91%E5%85%B3%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-number">1.21.2.</span> <span class="toc-text">Gateway网关代码方式配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.21.3.</span> <span class="toc-text">动态路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%86%99%E6%B3%95%E6%96%B9%E5%BC%8F%EF%BC%88%E6%8E%A8%E8%8D%90%E8%BF%99%E7%A7%8D%EF%BC%8C%E8%BF%99%E7%A7%8D%E4%B8%8D%E9%9C%80%E8%A6%81%E5%9C%A8%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84%E5%8A%A0%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%EF%BC%89"><span class="toc-number">1.21.3.1.</span> <span class="toc-text">第二种动态路由写法方式（推荐这种，这种不需要在访问路径加服务名称就可以直接访问）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Predicate-%E6%96%AD%E8%A8%80%E5%B7%A5%E5%8E%82%E7%9A%84%E4%BD%BF%E7%94%A8%E3%80%90%E4%BA%86%E8%A7%A3%E3%80%91"><span class="toc-number">1.22.</span> <span class="toc-text">Predicate 断言工厂的使用【了解】</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%A4%9F%E6%B7%BB%E5%8A%A0%E6%96%AD%E8%A8%80%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%9C%89%E8%BF%99%E4%BA%9B"><span class="toc-number">1.22.1.</span> <span class="toc-text">能够添加断言条件的有这些</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter%E8%BF%87%E6%BB%A4%E5%99%A8%E5%B7%A5%E5%8E%82%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">1.23.</span> <span class="toc-text">Filter过滤器工厂（重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.23.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.23.2.</span> <span class="toc-text">分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%88%86%E4%B8%A4%E7%A7%8D"><span class="toc-number">1.23.2.1.</span> <span class="toc-text">按生命周期分两种</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E7%A7%8D%E7%B1%BB%E5%88%86%E4%B9%9F%E6%98%AF%E4%B8%A4%E7%A7%8D"><span class="toc-number">1.23.2.2.</span> <span class="toc-text">按种类分也是两种</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GlobalFilter%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.23.3.</span> <span class="toc-text">GlobalFilter过滤器使用：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.23.4.</span> <span class="toc-text">IP地址访问过滤器实例：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E9%99%90%E6%B5%81%EF%BC%8C%E9%9D%A2%E8%AF%95%E4%B8%8D%E4%BC%9A%E7%9B%B4%E6%8E%A5%E9%97%AE%EF%BC%8C%E8%80%8C%E6%98%AF%E9%97%B4%E6%8E%A5%E6%9D%A5%E9%97%AE-%E9%97%AE-%E4%B8%8D%E5%8D%96%E8%B6%85"><span class="toc-number">1.23.5.</span> <span class="toc-text">关于限流，面试不会直接问，而是间接来问  问  不卖超</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Alibaba"><span class="toc-number">1.24.</span> <span class="toc-text">Spring Cloud Alibaba</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.24.1.</span> <span class="toc-text">项目介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">1.24.2.</span> <span class="toc-text">组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos"><span class="toc-number">1.25.</span> <span class="toc-text">Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.25.1.</span> <span class="toc-text">Nacos的核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%EF%BC%88Service%EF%BC%89"><span class="toc-number">1.25.2.</span> <span class="toc-text">服务（Service）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%88Service-Registry%EF%BC%89"><span class="toc-number">1.25.3.</span> <span class="toc-text">服务注册中心（Service Registry）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%88Service-Metadata%EF%BC%89"><span class="toc-number">1.25.4.</span> <span class="toc-text">服务元数据（Service Metadata）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%EF%BC%88Service-Provider%EF%BC%89"><span class="toc-number">1.25.5.</span> <span class="toc-text">服务提供方（Service Provider）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9%EF%BC%88Service-Consumer%EF%BC%89"><span class="toc-number">1.25.6.</span> <span class="toc-text">服务消费方（Service Consumer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%EF%BC%88Configuration%EF%BC%89%E2%80%94%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BF%83"><span class="toc-number">1.25.7.</span> <span class="toc-text">配置（Configuration）—配置文件中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%EF%BC%88Configuretion-Management%EF%BC%89"><span class="toc-number">1.25.8.</span> <span class="toc-text">配置管理（Configuretion Management）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E5%AD%97%E6%9C%8D%E5%8A%A1%EF%BC%88Naming-Service%EF%BC%89"><span class="toc-number">1.25.9.</span> <span class="toc-text">名字服务（Naming Service）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%EF%BC%88Configuration-Service%EF%BC%89"><span class="toc-number">1.25.10.</span> <span class="toc-text">配置服务（Configuration Service）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NacosServer%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%90%AF%E5%8A%A8"><span class="toc-number">1.25.11.</span> <span class="toc-text">NacosServer的安装和启动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">1.25.11.1.</span> <span class="toc-text">安装：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.25.11.2.</span> <span class="toc-text">Java编写配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E7%9A%84%E5%9F%BA%E6%9C%ACyml%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.25.11.3.</span> <span class="toc-text">Nacos的基本yml配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E6%95%B4%E5%90%88Gateway%E7%BD%91%E5%85%B3"><span class="toc-number">1.25.11.4.</span> <span class="toc-text">Nacos整合Gateway网关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8Nacos%E4%B8%ADyaml%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">1.25.12.</span> <span class="toc-text">常用Nacos中yaml文件配置代码：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BF%83"><span class="toc-number">1.25.13.</span> <span class="toc-text">Nacos配置文件中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">1.25.14.</span> <span class="toc-text">配置文件中心配置方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E7%AB%AF"><span class="toc-number">1.25.14.1.</span> <span class="toc-text">Nacos端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E7%AB%AF%EF%BC%9A"><span class="toc-number">1.25.14.2.</span> <span class="toc-text">Java端：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%8F%96%E6%96%B9%E5%BC%8F%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">1.25.15.</span> <span class="toc-text">配置文件的读取方式（重点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%9A"><span class="toc-number">1.25.16.</span> <span class="toc-text">多配置文件读取：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.25.17.</span> <span class="toc-text">公共配置文件配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%99%E4%BB%80%E4%B9%88%E5%86%85%E5%AE%B9"><span class="toc-number">1.25.18.</span> <span class="toc-text">两端的配置文件写什么内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.26.</span> <span class="toc-text">项目结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">1.26.1.</span> <span class="toc-text">单体结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE%EF%BC%9A"><span class="toc-number">1.26.2.</span> <span class="toc-text">分布式聚合项目：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%881%EF%BC%9A"><span class="toc-number">1.26.3.</span> <span class="toc-text">分布式聚合项目优化方案1：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%88%B6%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B"><span class="toc-number">1.27.</span> <span class="toc-text">分布式微服务父项目配置案例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/23/learnnote/shu-ju-jie-gou-yu-suan-fa/suan-fa-mo-ban/dan-diao-zhan/" title="单调栈"><img src="/img/lkjdntub.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="单调栈"/></a><div class="content"><a class="title" href="/2025/04/23/learnnote/shu-ju-jie-gou-yu-suan-fa/suan-fa-mo-ban/dan-diao-zhan/" title="单调栈">单调栈</a><time datetime="2025-04-23T17:49:42.188Z" title="发表于 2025-04-23 17:49:42">2025-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/23/learnnote/ren-gong-zhi-neng/sumo-yu-python-jiao-ben/" title="无标题"><img src="/img/v2-be978e0a20cac694530450ecd166b6ca_r.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无标题"/></a><div class="content"><a class="title" href="/2025/04/23/learnnote/ren-gong-zhi-neng/sumo-yu-python-jiao-ben/" title="无标题">无标题</a><time datetime="2025-04-23T17:49:42.129Z" title="发表于 2025-04-23 17:49:42">2025-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/19/learnnote/sql-xue-xi/mysql-tong-shi-an-zhuang-duo-ge-ban-ben/" title="MySQL同时安装多个版本"><img src="/img/1483601935045.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL同时安装多个版本"/></a><div class="content"><a class="title" href="/2025/04/19/learnnote/sql-xue-xi/mysql-tong-shi-an-zhuang-duo-ge-ban-ben/" title="MySQL同时安装多个版本">MySQL同时安装多个版本</a><time datetime="2025-04-19T14:30:35.000Z" title="发表于 2025-04-19 14:30:35">2025-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/18/learnnote/java-xue-xi-bi-ji/zookeeper-xue-xi/" title="zookeeper学习"><img src="/img/wallhaven-wqery6-dark.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zookeeper学习"/></a><div class="content"><a class="title" href="/2025/04/18/learnnote/java-xue-xi-bi-ji/zookeeper-xue-xi/" title="zookeeper学习">zookeeper学习</a><time datetime="2025-04-18T15:34:09.000Z" title="发表于 2025-04-18 15:34:09">2025-04-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/18/learnnote/java-xue-xi-bi-ji/activemq-xue-xi/" title="ActiveMQ学习"><img src="/img/ae9a1729c7a2c9f12ccef9b25478c670.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ActiveMQ学习"/></a><div class="content"><a class="title" href="/2025/04/18/learnnote/java-xue-xi-bi-ji/activemq-xue-xi/" title="ActiveMQ学习">ActiveMQ学习</a><time datetime="2025-04-18T15:18:00.000Z" title="发表于 2025-04-18 15:18:00">2025-04-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 长白崎</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img style="position:relative;top:4px;width:20px;height:20px;" src="https://npm.elemecdn.com/nanshen@latest/img/icp.webp" alt="ICP"><span>桂ICP备2022007220号-2</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><a class="rightMenu-item menu-link" id="menu-radompage" href="/random/index.html"><i class="fa-solid fa-shoe-prints"></i><span>随便逛逛</span></a><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div><div class="rightMenu-item" id="menu-print"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js?v=5.3.5"></script><script src="/js/main.js?v=5.3.5"></script><script src="/js/tw_cn.js?v=5.3.5"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://vercel.changbaiqi.top',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://unpkg.com/@waline/client@v3/dist/waline.css')
        .then(() => import('https://unpkg.com/@waline/client@v3/dist/waline.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'src'
          const lazyloadNative = ''
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}" ${lazyloadNative}></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '暂无评论'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'waline-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const getComment = async (ele) => {
    try {
      const res = await fetch('https://vercel.changbaiqi.top/api/comment?type=recent&count=6')
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      btf.saveToLocal.set(keyName, JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray, ele)
    } catch (err) {
      console.error(err)
      ele.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  run(keyName, getComment)
})</script><div class="aplayer no-destroy" data-id="9156303892" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script src="/js/showAppreciation.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/click-show-text.min.js" data-mobile="true" data-text="爱国,公正,平等,富强,和谐,热爱,Ciallo～(∠・ω&lt; )⌒★" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: true,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.3.5"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: true,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>